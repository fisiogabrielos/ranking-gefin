<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Ranking GEFIN - HYPERDRIVE!</title>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Press+Start+2P&family=Orbitron:wght@400;700&display=swap');

    :root {
      --sci-fi-cyan: #00ffff;
      --sci-fi-magenta: #ff00ff;
      --sci-fi-blue: #0077ff;
      --sci-fi-dark-blue: #020818;
      --sci-fi-yellow: #f7ff00;
      /* Propriedades para o scanner do mouse */
      --mouse-x: 50vw;
      --mouse-y: 50vh;
    }

    body {
      font-family: 'Orbitron', sans-serif;
      background-color: var(--sci-fi-dark-blue);
      color: #fff;
      text-align: center;
      padding: 20px 5%;
      overflow: hidden; /* Esconde o overflow do scanner */
      position: relative;
    }
    
    /* Efeito de Scanner que segue o mouse */
    body::before {
        content: '';
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: radial-gradient(circle at var(--mouse-x) var(--mouse-y), 
                                    rgba(0, 119, 255, 0.2) 0%, 
                                    transparent 20%, 
                                    transparent 100%);
        z-index: 2;
        pointer-events: none; /* Permite clicar atrav√©s dele */
        transition: background 0.1s ease-out;
    }

    /* Fundo de estrelas animado */
    .stars {
      position: fixed;
      top: 0; left: 0; width: 100%; height: 100%;
      background: #020818 url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAQAAADZc7J/AAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAAAAmJLR0QAAKqNIzIAAAAHdElNRQflCBgQIRv5Kx2TAAAAe0lEQVRIx2NgGBoAWaAdwAAGZAOALGCiAsoA0gAAVhB8BwD+3yX/X2UMgOqAFLsB/z/D/3+G/+skAP8//2/2/w/ff4a/f5L/b4YBAAFgMv9/hv+/wP8/JP8/I/8//3+G/3+G/5/l/x8A+L8M/z/L/58R/v8f/v8f/v8P//8H/z8DAAAMALs045yLiYpPAAAAAElFTkSuQmCC) repeat;
      z-index: -1;
      animation: space-travel 15s linear infinite;
    }

    @keyframes space-travel {
        from { background-position: 0 0; }
        to { background-position: 256px 256px; }
    }
    
    h1 {
      font-family: 'Press Start 2P', cursive;
      color: var(--sci-fi-cyan);
      text-shadow: 0 0 5px var(--sci-fi-cyan), 0 0 10px var(--sci-fi-cyan), 0 0 20px var(--sci-fi-magenta);
      font-size: clamp(1.5rem, 5vw, 2.5rem);
      margin-bottom: 30px;
    }

    /* Mensagem de loading */
    #loading-thrusters {
      font-size: clamp(1rem, 4vw, 1.5rem);
      color: var(--sci-fi-yellow);
      text-shadow: 0 0 5px var(--sci-fi-yellow);
      margin: 100px 0;
      min-height: 1.5rem; /* Evita que a p√°gina pule */
    }
    
    table {
      margin: 0 auto;
      border-collapse: separate;
      border-spacing: 0;
      width: 100%;
      max-width: 900px;
      background: rgba(10, 25, 47, 0.85);
      border: 2px solid var(--sci-fi-cyan);
      box-shadow: 0 0 15px var(--sci-fi-cyan);
      backdrop-filter: blur(5px);
      visibility: hidden;
      opacity: 0;
      transition: opacity 0.5s ease, transform 0.5s ease;
      transform: scale(0.95);
    }
    
    table.loaded {
      visibility: visible;
      opacity: 1;
      transform: scale(1);
    }

    th, td {
      padding: 15px;
      text-align: center;
      border-bottom: 1px solid rgba(0, 255, 255, 0.2);
    }
    
    th {
      font-family: 'Press Start 2P', cursive;
      font-size: 0.8rem;
      color: var(--sci-fi-yellow);
    }
    
    tbody tr {
        opacity: 0;
        transform: translateX(-50px);
        animation: row-fly-in 0.5s forwards cubic-bezier(0.25, 0.46, 0.45, 0.94);
    }

    @keyframes row-fly-in {
        to { opacity: 1; transform: translateX(0); }
    }
    
    tbody tr.flash {
        animation: row-flash 0.4s ease-out;
    }
    @keyframes row-flash {
        0%, 100% { background-color: transparent; }
        50% { background-color: rgba(0, 255, 255, 0.3); }
    }

    .top1 {
      font-size: 1.2rem;
      font-weight: bold;
      animation: top1-pulse 2s infinite;
      border-top: 2px solid var(--sci-fi-yellow);
      border-bottom: 2px solid var(--sci-fi-yellow) !important;
    }

    @keyframes top1-pulse {
      0%, 100% { background-color: rgba(247, 255, 0, 0.1); box-shadow: 0 0 15px 5px rgba(247, 255, 0, 0.2); }
      50% { background-color: rgba(247, 255, 0, 0.2); box-shadow: 0 0 25px 10px rgba(247, 255, 0, 0.4); }
    }

    .medal { font-size: 1.5rem; display: inline-block; }

    /* Cometa animado */
    #comet {
        position: fixed;
        font-size: 2.5rem;
        bottom: 50%;
        left: -100px;
        animation: comet-fly 25s linear infinite;
        animation-delay: 3s;
        z-index: 10;
        text-shadow: 0 0 10px #fff, 0 0 20px var(--sci-fi-cyan), 0 0 40px var(--sci-fi-cyan);
    }
    @keyframes comet-fly {
        0% { transform: translateX(0) rotate(15deg); }
        100% { transform: translateX(120vw) rotate(15deg); }
    }

    @media (max-width: 768px) {
      table, thead, tbody, th, td, tr { display: block; }
      thead { display: none; }
      tr { margin-bottom: 15px; border: 2px solid var(--sci-fi-cyan); }
      td { padding-left: 50%; position: relative; text-align: right; border-bottom: 1px solid rgba(0, 255, 255, 0.1); }
      td:last-child { border-bottom: none; }
      td::before {
        content: attr(data-label);
        position: absolute; left: 10px; width: 45%;
        padding-right: 10px; white-space: nowrap;
        text-align: left; font-weight: bold;
        color: var(--sci-fi-yellow);
      }
    }
  </style>
</head>
<body>
  <div class="stars"></div>
  <div id="comet">‚òÑÔ∏è</div>

  <h1 data-text="üèÜ Ranking GEFIN - Salto contramovimento üåå"></h1>
  
  <p id="loading-thrusters"></p>
  
  <table id="ranking">
    <thead>
      <tr>
        <th>Posi√ß√£o</th>
        <th>Cadete</th>
        <th>Salto (m)</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>
  
  <audio id="boot-sound" src="https://actions.google.com/sounds/v1/science_fiction/electronic_boot_up.ogg" preload="auto"></audio>
  <audio id="row-sound" src="https://actions.google.com/sounds/v1/science_fiction/laser_flyby.ogg" preload="auto"></audio>
  <audio id="powerup-sound" src="https://actions.google.com/sounds/v1/science_fiction/power_up_2.ogg" preload="auto"></audio>
  <audio id="click-sound" src="https://actions.google.com/sounds/v1/science_fiction/futuristic_blip_short.ogg" preload="auto"></audio>

  <script>
    // --- EFEITO DE SCANNER DO MOUSE ---
    window.addEventListener('mousemove', e => {
      document.body.style.setProperty('--mouse-x', `${e.clientX}px`);
      document.body.style.setProperty('--mouse-y', `${e.clientY}px`);
    });

    // --- FUN√á√ÉO PARA ANIMA√á√ÉO DE TEXTO (BOOT SEQUENCE) ---
    function typeScramble(element, text, onComplete) {
        let i = 0;
        const chars = '!<>-_\\/[]{}‚Äî=+*^?#________';
        const interval = setInterval(() => {
            element.textContent = text.substring(0, i) + 
                                  Array.from({length: text.length - i}, () => chars[Math.floor(Math.random() * chars.length)]).join('');
            i++;
            if (i > text.length) {
                clearInterval(interval);
                element.textContent = text;
                if (onComplete) onComplete();
            }
        }, 50);
    }
    
    // --- FUN√á√ÉO PARA ANIMA√á√ÉO DE CONTAGEM DE N√öMEROS ---
    function animateCountUp(element, finalValue) {
        let start = 0;
        const duration = 750; // 0.75 segundos
        const stepTime = Math.abs(Math.floor(duration / finalValue));
        const timer = setInterval(() => {
            start += 1;
            element.textContent = start;
            if (start === finalValue) {
                clearInterval(timer);
            }
        }, stepTime);
    }

    const publicSpreadsheetUrl = "https://docs.google.com/spreadsheets/d/e/2PACX-1vQ1PFABZm_ON5E8_cMwlbVu6MZcHFAyyptjHNae4PYXkPVq4rBfd1-T0O1opyxn50M_krEEIo1MSec2/pub?output=csv";

    async function loadRankingData() {
      const h1 = document.querySelector('h1');
      const loadingText = document.getElementById('loading-thrusters');
      document.getElementById('boot-sound').play().catch(e => {});

      typeScramble(h1, h1.getAttribute('data-text'), () => {
          typeScramble(loadingText, "CALIBRANDO PROPULSORES...");
      });
      
      await new Promise(r => setTimeout(r, 2000));

      try {
        const response = await fetch(publicSpreadsheetUrl);
        const csvText = await response.text();
        const data = parseCSV(csvText);
        
        loadingText.style.transition = 'opacity 0.5s';
        loadingText.style.opacity = '0';
        
        await new Promise(r => setTimeout(r, 500));
        document.getElementById('ranking').classList.add('loaded');
        await showInfo(data);

      } catch (error) {
        console.error("Falha:", error);
        typeScramble(loadingText, "ERRO DE TELEMETRIA");
      }
    }

    function parseCSV(text) {
      const lines = text.trim().split('\n');
      if (lines.length < 2) return [];
      const headers = lines[0].split(',').map(header => header.trim());
      return lines.slice(1).map(line => {
        const values = line.split(',').map(value => value.trim());
        let entry = {};
        headers.forEach((header, index) => { entry[header] = values[index] || ''; });
        return entry;
      });
    }
    
    async function showInfo(data) {
      data.sort((a, b) => parseFloat(b["Altura m√°xima (cm)"]) - parseFloat(a["Altura m√°xima (cm)"]));
      const tbody = document.querySelector("#ranking tbody");
      tbody.innerHTML = "";

      for (const [index, item] of data.entries()) {
        await new Promise(r => setTimeout(r, 150));
        const rowSound = document.getElementById("row-sound");
        rowSound.currentTime = 0;
        rowSound.play().catch(e => {});

        const row = document.createElement("tr");
        row.style.animationDelay = `${index * 0.1}s`;

        let medal = "";
        if(index === 0) { 
          row.classList.add("top1"); 
          medal = "ü™ê"; 
          document.getElementById("powerup-sound").play().catch(e => {});
        }
        else if(index === 1) { medal = "üöÄ"; }
        else if(index === 2) { medal = "‚≠ê"; }
        
        const score = parseInt(item["Altura m√°xima (cm)"], 10) || 0;
        row.innerHTML = `
          <td data-label="Posi√ß√£o">${index + 1}¬∫ <span class="medal">${medal}</span></td>
          <td data-label="Cadete">${item.Nomes}</td> 
          <td data-label="Salto (m)" class="score-cell">${0}</td>
        `;
        tbody.appendChild(row);

        // Inicia a contagem do placar
        const scoreCell = row.querySelector('.score-cell');
        animateCountUp(scoreCell, score);
        
        // Adiciona interatividade de clique
        row.addEventListener('click', () => {
            row.classList.remove('flash'); // Reseta a anima√ß√£o se j√° estiver l√°
            void row.offsetWidth; // Truque para reiniciar a anima√ß√£o CSS
            row.classList.add('flash');
            document.getElementById('click-sound').play().catch(e => {});
            row.addEventListener('animationend', () => row.classList.remove('flash'), { once: true });
        });
      }
    }
    
    window.addEventListener("DOMContentLoaded", loadRankingData);
  </script>
</body>
</html>
